jdk: oraclejdk8
language: android
android:
  components:
  - build-tools-27.0.3
  - android-27
  - extra-android-m2repository
script:
- "./gradlew :app:assembleRelease"
- "./gradlew :push:assembleRelease"
before_install:
- yes | sdkmanager "platforms;android-27"
- openssl aes-256-cbc -K $encrypted_9351aabe1378_key -iv $encrypted_9351aabe1378_iv -in android.jks.enc -out android.jks -d
- chmod +x gradlew
before_deploy:
  - export VERSION=$(git rev-parse --short HEAD)"-SNAPSHOT"
  - mv "app/build/outputs/apk/release/app-release.apk" "app/build/outputs/apk/release/manager.apk"
  - mv "push/build/outputs/apk/release/push-release.apk" "push/build/outputs/apk/release/xmsf_service.apk"
  - git tag $VERSION
deploy:
  name: ${VERSION}
  body: Snapshot version automatically generated by Travis CI, there are some problems, please be cautious experience.
  prerelease: true
  provider: releases
  skip_cleanup: true
  api_key:
      secure: CMoA921jLv10Xivl/YGKs2ziJeSaCWRRM1zUuhr6r+5+vftbJ7wnrVzDJxGbEAglwB5bUcLFN+fQwa+ga5SWi7VtHwjP4noXvtSjvM+xuQhBpKJBIaV4tBKYJOlkFpHo0AiNEOKysO70dHsj1fXIhAIgSkHKPtTiUoVeR1DvmVe0kNfXmVXgzX6noz58iP7lKimVYn2ckgYa/JMfb1qS789d/ZvjVPXDnbzR2J/LVIrc2CVIgn7fWSWG6ib6LP7rKlr4/Z9rREd4W4X1+nsm6wY6oRfRbZz+2+8b+2V4pQGKtwZunee6OsLFqzoR7BwzzqAJVPmc+WM2IiElh/dLbPgST/RTTmjlolRRH2Frv/3E/llGNzyUchn1rFbkwgVRJlXapYV39zc2WHsN06UTjoKsOZXzol6WR2Xt59LSONTxJeOu2aEKkbdiPr2S6w2Oa8SNoE+xsMG5y5nqt2J8+zWp5gaAnxSzmSHWn4+nTDiegWWTWhOCfaHPbcnESs0XMal6QrnktvVucHgV8Dtsnh4o2Nn1b25jNe+y1J6MYb1m44gr2H+R3eq5tFl/oxBhZsB//FEJfHpi7Il4QOkT59H1Iode6HZUdiJ9tfxbsFd9IiTms+1JQVJTLF3EnuwUx0qJMsPXO7XmMYfsH+zcGPmVC3lKroZ/QMG6MD1Xcw8=
  file:
    - "app/build/outputs/apk/release/manager.apk"
    - "push/build/outputs/apk/release/xmsf_service.apk"
  on:
    repo: gzsll/MiPushFramework
